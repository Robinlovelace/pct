---
title: 'The Propensity to Cycle Tool: An open source online system for sustainable
  transport planning'
csl: elsevier-harvard.csl
header-includes: \usepackage{amsmath} \usepackage{longtable} \usepackage{booktabs}
output:
  word_document: default
  pdf_document:
    fig_caption: yes
    number_sections: yes
bibliography: ../documents/Transport.bib
---

```{r, echo=FALSE, include=FALSE}
# output: word_document
    # fig_caption: yes

# output: 
#   pdf_document: 
#     fig_caption: yes
#     number_sections: yes
#     toc: yes
# header-includes: \usepackage{amsmath}
#                  \usepackage{longtable}
#                  \usepackage{booktabs}
# author:
#   - name: Robin Lovelace
#     affiliation: '1'
#   - name: Rachel Aldred
#     affiliation: '2'
#   - name: Anna Goodman
#     affiliation: '3'
#   - name: James Woodcock
#     affiliation: '4'
#     
# affiliation:
#   - id: '1'
#     department: Consumer Data Research Centre, School of Geography
#     institution: University of Leeds
#     city: Leeds
#     state: West Yorkshire
#     country: UK
#   - id: '2' 
#     department: Dept/Program/Center
#     institution: Institution Name
#     city: City
#     state: State
#     country: Country
#   - id: '3' 
#     department: Dept/Program/Center
#     institution: Institution Name
#     city: City
#     state: State
#     country: Country
#   - id: '4' 
#     department: Dept/Program/Center
#     institution: Institution Name
#     city: City
#     state: State
#     country: Country
# output: rticles::els_article
if(grepl(pattern = "pct$", x = getwd())){
  setwd("documents")
}
# source("../set-up.R")
pkgs <- c("stplanr", "knitr", "xtable", "sp", "grid", "png")
vapply(pkgs, require, character.only = T, FUN.VALUE = logical(1))

# To do:
# Add speed-bumps/speed cameras/cycling priority or remove lanes for motorised traffic
# Thanks also to Phil Tate for comments
```

# Abstract

Encouraging cycling, as part of a wider sustainable mobility strategy, is an
increasingly common objective in transport planning institutions worldwide.
Emerging evidence shows that providing appropriate high-quality infrastructure
can boost local cycling rates. To maximize the benefits and cost-effectiveness of new
infrastructure, it is important to build in the right places.
Cycle paths, for example, will have the greatest impact if they are constructed
along 'desire lines' of greatest latent demand.
The Propensity to Cycle Tool (PCT) seeks to inform such decisions by providing an
evidence-based support tool that models current and potential future
distributions and volumes of cycling across cities and regions. This paper
describes this model and its application to case study cities in England.
Origin-destination (OD) data, combined with
quantitative information at the level of administrative zones,
form the basis of the model, which estimates cycling potential as a function of
route distance, hilliness and other factors at the OD and area level.
Multiple scenarios were generated and interactively displayed.
These were: 'Government Target', in which the rate of cycling doubles in England;
'Gender Equality', in which women cycle as much as men;
‘Go Dutch’, in which English people cycle as much as people in
the Netherlands; and 'E-bikes', an exploratory analysis of increasing the distance
people are willing to cycle due to new technology.
The model is freely available online and can be accessed at [geo8.webarch.net/master/](http://geo8.webarch.net/master/).
This paper also explains how the model's open source code base
allows the PCT approach to be deployed in new contexts.
We conclude that the method presented has potential to assist
with planning for cycling-dominated cities worldwide, which can in turn
assist with the global transition away from fossil fuels.

# Introduction

Cycling can play an important role in making transport systems more
sustainable, healthy and equitable.
This mode of transport already provides fast, affordable,
healthy and convenient mobility to millions of people each day [@Komanoff2004].
Mounting evidence of the external costs associated with car-dominated
transport systems [@Newman1999;@Han2008;@Mizutani2011;@Shergold2012]
and the benefits of cycling [@Oja2011;@Woodcock2013;@DeNazelle2011]
has pushed cycling up the
transport agenda.
Cycling is no longer regarded as a fringe mode of transport, as
illustrated, for example, by the global
proliferation of publicly subsidized 'bike share' schemes
[@OBrien2014a].^[An
interactive web map associated with @OBrien2014a
illustrates the distribution of many of the
largest
bike share schemes worldwide. See
[bikes.oobrien.com](http://bikes.oobrien.com).]
Emerging evidence illustrates that high-quality infrastructure
is an effective way of promoting cycling
as a safe, accessible and convenient
transport option for people of all ages and abilities [@Heinen2015].
Thanks to various designs of modified cycles (e.g. quadricycles and handcycles),
cycling can also provide an efficient means of self propulsion for people who
would otherwise depend on motorised modes or
other people [@Aldred2008].

Within this fast-moving policy context,
the question of where to construct new cycle infrastructure
is of strategic importance. In response, professional transport planners and
consultancies have developed new methods for identifying cost-effective infrastructure
interventions, such as Aecom's proprietary Permeability Assessment Tool
[@Payne2014]. Yet geographically specific prioritisation of new infrastructure
is seldom raised in academic research on cycling and active travel more widely.
The design [@Heath2006;@TfL2014;@WG2014]
and geographic location [@Aultman-Hall1997;@Minikel2012]
of cycle paths are
important factors influencing the attractiveness of cycling
and the rate of cycling [@Pucher2010].
Through the case study of the PCT, this paper explores the ability of strategic
transport planning support tools to assist the decision-making process
so that cycling investment is spent effectively.

The Propensity to Cycle Tool (PCT) is
an interactive map-based 'planning support system'
[@Geertman2009]. As with other previously documented online systems
[e.g. @CPE:CPE3282],
the PCT
provides a range of information to the user to inform evidence-based policy
[@Pettit2013]. The PCT differs from previous planning support systems, in its:

- Focus on future scenarios of cycling.
- Estimation and visualisation of information at
the zone and 'desire line' level.
- Route-allocation of OD pairs, enabling specific routes to be identified
for improvement.

The PCT was commissioned by the UK's Department for Transport to identify
"parts of the country [England] with the greatest propensity to cycle" to help
prioritise strategic investment in active travel [@DepartmentforTransport2015].
Part of the contract involved user testing sessions.
Over 70 practitioners and policy-makers provided feedback which provided
(i) confirmation of the tool's utility for decision-making;
(ii) input into the tool's user interface; and
(iii) ideas for future development.

The PCT is, to our knowledge,
the first online, interactive and open source
planning support system to focus explicitly on cycling. The
computer code underlying the PCT is open 
source, enabling the methods described in this paper to be
reproduced. With access to appropriate data (described in the next section)
and R programming skills, the PCT can be deployed in new
contexts. The codebase
underlying the PCT is publicly available at
[github.com/npct](https://github.com/npct) under the conditions of the MIT
license. The aggregate level OD model underlying the PCT was written in R,
a mature language for statistical computing [@RCoreTeam2015]. The
interface was written in **shiny**, an R package for creating online
web applications for data visualisation [@Chang2015].

The PCT is a *strategic* transport planning tool.
Its policy-relevance stems from its ability to develop, compare and visualise
various scenarios for cycling futures at city to national levels.
Unlike 'microscopic' transport
models such as SUMO and PTV VISSIM, which simulate vehicular traffic in
real time [@Behrisch2014;@Krajzewicz2014], the PCT is scalable
to the national level.
The PCT is also able to estimate cycling potential at
relatively fine-grained (and flexible) levels of geographic resolution
in contrast to 'macroscopic' transport models [e.g. @Kolosz2013].

Unlike @McCollum2009 and other national-level scenario-based approaches,
the PCT allows estimation of where new cycling trips are most likely to
be generated given predetermined overall increases in cycling.
This makes the tool especially well-suited to local-level analysis of
the impacts of achieving a target level of cycling
(typically measured as a proportion of all trips).
For example, our 'Government target' scenario assumes a doubling in
the level of cycling in England (DfT 2014).
Thus the PCT provides a method to answer the question:
if cycling increases by 'x' nationally or regionally,
how much is cycling likely to increase locally?
More specifically: along which routes would the new
cycle trips plausibly occur?

```{r, echo=FALSE}
#  As highlighted in the discussion,
# future work building on tools such as the PCT could help answer more complex
# and policy-relevant questions, such as:
# Which modes would new cycle trips replace?
# And hence, what would be the net benefits of these changes? 
# ^[We
# use the term 'cycle' instead of 'bicycle' to include trips made by
# tricycles, quadricycles and hand cycles.]
```

This ability to model propensity to cycle at the OD level is one important,
and novel, feature of the PCT.
An 'OD pair' in this context can be represented visually as a
'desire line'. This is the straight line connecting the origin (O) where
a trip begins with the destination (D)
where it ends [@Chan2003]. These concepts are related to the common
$T_{ij}$ matrix notation in transport modelling, which represent the number
of trips between origin and destination pairs
[@Ortuzar2001;@Simini2012].
The model takes OD level data and uses this to
simulate the proportion trips made by cycle
between OD pairs.
By aggregating data from the OD level to geographic zones, the PCT
model also enables area-based planning (encouraging users to focus on
particular zones rather than OD pairs). This inclusion of OD level data is one
important difference between PCT and previous approaches to modelling cycling
potential. @Parkin2008, for example, used
a multiple regression model to estimate levels of commuter cycling at an
area level. Similarly local, survey data has been used to identify areas with
high numbers of 'potentially cyclable trips' in London [@TfL2010].
However, neither analysis identified the travel corridors along which
these simulated cycle trips would be made.

Regression models such as that presented by @Parkin2008 have great potential
for creating an evidence-base for prioritising investment in cycle paths.
However, a key limitation of many models is that the results are not presented
in a form that is dynamic or accessible to transport planners.
By allocating the results of an individual-level regression model to the
route network, a method presented by @Zhang2014 was able to
prioritise routes to "achieve maximum impacts early on".
Our model differs by operating at the OD level
for scalability. Also the PCT approach provides a framework for implementing
scenarios of the future and a greater range of graphical and numerical
outputs. 

```{r, echo=FALSE}
# This is thanks in part to the flexible online interface.
# Key to the PCT's utility as a PSS for strategic sustainable transport planning
# is its ability to visualise various scenarios for cycling futures. The
# OD level model described in the Methods section explains how these scenarios
# can be translated into OD pairs at high geographical resolution and allocated to the
# route network. Scenarios can be based on national, regional or city-wide targets
# or alternative criteria, such as the outputs of an agent based model.
# Due to the open approach in model development the PCT methodology can be
# replicated in many other locations worldwide. We therefore expect this article
# to be useful not only academically, in terms of development of a OD level
# model for cycling and visualisation of the results, but also practically,
# for practitioners designing sustainable transport plans.

# The PCT was funded by the UK's Department
# for Transport (DfT). As a result, the approach was originally designed for
# use by Local Authority transport planners
# to prioritise where to investment in cycling, down to the route level,
# across England. However, the tool has much wider potential applications.

# The PCT model presented in this paper was deployed for three
# 'pilot' cities which
# acted as a 'proof of concept' for the DfT: Coventry,
# Manchester and Norwich. The method is described in a generalisable way
# so it is applicable to any city or region where the appropriate datasets
# are available. The 'generalisability' of the method is important due to
# the momentum behind cycling in cities across the world.
# Planning support tools such as the PCT can help the
# associated investment to be spent effectively, yielding more efficient
# targeting of resources.
```

```{r, echo=FALSE}
# This transition is needed to prevent runaway
# climate change . The worldwide uptake of cycling, driven by well-placed
# infrastructure,
# 'soft' policy incentives and wider cultural shifts away from the car will also
# have enormous health benefits.
# The design of such infrastructure and policies
# can be enhanced by tools such as the
# PCT. Given the tool's great potential for wider social benefit, it is
# vital to communicate the underlying methods and software.

# The aim of the present paper is to explain the underlying model which drives
# the scenarios used in the PCT. This is of academic interest due to
# the increased accuracy with which the method can estimate the
# spatial distribution for cycle infrastructure. It is also of
# great policy relevance during a time of transition away from energy inefficient
# forms of transport such as the personal automobile.
# The model described in this paper is easy to modify and extend,
# despite the online interface being easy to learn (it little more complex than
# Google Maps, which many users will have experience with).
```

The scenarios are highly responsive to user input.
This is because the results for each scenario are pre-calculated,
rather than being computed 'on the fly'.
To ensure the model is accessible, the
user is not required to specify any numerical model parameters to interact with
the PCT. Advanced users can modify any part of the model, for example to
allow updated scenarios to be generated and presented based on new evidence.
Furthermore, the PCT's open source approach reduces two additional barriers to
effective use of transport planning software: cost and access to source code.
With the PCT anyone with programming
skills can enhance the tool for their own purposes.
The PCT is part of a wider trend in transport research towards
greater transparency in software development and collaboration [@Tamminga2012;@novosel2015agent]..
The transferability of the PCT to new settings is likewise enhanced
by its use of aggregate OD data,
which is more readily available than individual level data.
The use of aggregate OD data also makes the model highly scalable.
The PCT thus has the potential to provide a basis for the creation of new
cycling planning tools in new contexts.

```{r, echo=FALSE}
# We plan to encourage a user community to
# build up around the tool and to create new versions for specific applications
# in future versions of the PCT.
# This could involve running training sessions for transport planners with
# programming experience.

# All of the code underlying PCT has been made available open source under the
# MIT license on the GitHub platform.^[See
# [github.com/npct/pct](https://github.com/npct/pct).]
# The model is implemented in R, a mature language for statistical computing.
# This use of open source code and freely-available software,
# in combination with the use of input data that are widely available in many settings,
# means that the model has the potential to support transport planning in contexts.
# The remainder of this paper therefore describes the model underlying the PCT,
# presents a case study in which these methods are applied to three cities in England,
# and describes how the approach could be applied to other settings.
```


# Data


The PCT relies on two key input datasets:

- *Origin-destinateion* (OD) data relating the number of trips
taking place between administrative zones. These can be represented as
straight 'desire lines' or allocated to the route network.
- *Geographical data* providing the coordinates of trip
origins and destinations.

Hilliness and route network distance were also used in the regression model.
The OD model described in this paper can work for
anywhere that has access to such data. To link
the OD and geographic datasets together, *zone ids* are needed in both
datasets. An R package, **stplanr**, was developed for this purpose
and other data manipulation
challenges.

```{r, echo=FALSE}
# ^[The
# source code of `gFlow2Lines()` has been made available
# online, as part of an R package for sustainable transport planning,
# **stplanr**. See [github.com/Robinlovelace/stplanr/](https://github.com/Robinlovelace/stplanr/blob/master/R/gFlow.R).]
```

Tables 1 and 2 illustrate the two input datasets. Fig. 1
shows the output, straight lines with attributes for
each OD pair in both directions. These are also referred to as 'desire lines' when
represented as straight lines on the map [see @Tobler1987; @Chan2003].
The visualisation of the OD data builds
on published work on cartographic visualisation [@Rae2009;@Wood2010].
The model for England described in this paper uses the following open datasets
(similar OD datasets are available for cities across the world):

Table: Sample of the OD input dataset, representing the number of people who commute from locations within and between administrative zones (MSOAs)

```{r tflow, echo=FALSE, results='asis'}
# For latex version: use xtable:
# t1 <- xtable(head(flow[c(1:3, 12)]), caption = "Sample of the 'flow' input dataset, representing the number of people who commute from locations within and between administrative zones (MSOAs)", label = "tbl:flow")
# print(t1, type = "latex", comment = FALSE, caption.placement = "top")

# For docx and latex: use kable
kable(head(flow[c(1:3, 12)]))
```

Table: Sample of the 'cents' input dataset, representing the geographical location of the population-weighted centroids of MSOA zones described in Table 1.

```{r tcents, echo=FALSE, results='asis'}
# t2 <- xtable(as.data.frame(cents[1:3,-c(3,4)]), caption = "Sample of the 'cents' input dataset, representing the geographical location of the population-weighted centroids of MSOA zones described in Table~\\ref{tbl:flow}", label = "tbl:cents")
# print(t2, type = "latex", comment = FALSE, caption.placement = "top")
kable(as.data.frame(cents[1:3,-c(3,4)]))
```

```{r, echo=FALSE, fig.cap="Illustration of the OD data converted into geographical lines between origin and destination pairs for Coventry. Width represents the total number of trips. Note the use of population-weighted (as opposed to geographic) centroids used for the point of departure and destination."}
# data("flowlines")
# plot(flowlines, lwd = flowlines$All / 10)
grid.raster(readPNG("../figures/coventry-centroids.png"))
```

- OD data representing the number of trips between origin destination pairs,
disaggregated by mode of travel.
We used the file `wu03ew_v2.csv`, obtained from the UK Data Service
(see Table 2 for a sample of this dataset)^[See [wicid.ukdataservice.ac.uk/cider/wicid/downloads.php](https://wicid.ukdataservice.ac.uk/cider/wicid/downloads.php).]
Note the origin and destination codes in some rows
are the same, indicating *intra-zone* travel.

- The population-weighted centroids of local
administrative zones (see Table 1). We used the official UK 'Medium Super
Output Areas' (MSOAs) zonal system for both origins and destinations.
MSOAs are a geographic unit used for the release of UK
statistical data (average population around 7,800 people).
This file was originally downloaded as a Shapefile
under the UK's Open Government
Licence.^[See [data.gov.uk/dataset/lower-layer-super-output-areas-ew-2011-population-weighted-centroids](http://data.gov.uk/dataset/lower-layer-super-output-areas-ew-2011-population-weighted-centroids).]

- Route distance, assigned to each desire line
using the CycleStreets.net
API.^[To implement this functionality in a generalisable way
a custom function, `route_cyclestreet()`, was
written for the R package **stplanr**.]

- Hilliness of zones and routes.
There are various ways to generate this data, ranging from the simple
(e.g. vertical displacement between origin and destination) to the
complex (e.g. total amount of climb along the route network in both directions).
We calculated gradient per MSOA zone using digital elevation model (DEM)
data supplied by NASA.^[See
[srtm.csi.cgiar.org/](http://srtm.csi.cgiar.org/). "Version 4" of the dataset was used.
To allocate this area-based hilliness metric to OD pairs, we calculated the average
hilliness of origin and destination zones. This method has the disadvantage that
accuracy decreases with increased trip distance.]

We used the English Census 2011 dataset on travel to work OD pairs
for its comprehensive coverage of the population,
high geographic resolution and assurances surrounding
data quality. Official data on commuting and education trips are available
from official sources in many countries.
In cases where no census data are available
(e.g. in relation to shopping trips), some combination of the aforementioned
alternative sources
may be able to provide a reasonable approximation of real world travel.

A variety of emerging sources can also provide OD data,
including 'Big Data' from commercial companies.
These alternative sources of OD data include:
mobile telephone service providers
[@smoreda2013spatiotemporal];
public transport data [@Kitchin2013]; household
travel surveys [@TransportforNSW2014];
geolocated social media [@Stefanidis2013].

```{r, echo=FALSE}
# In practice using multiple datasets may be the most appropriate option.
# Individual and areal data can, for example, be combined using spatial
# microsimulation, allowing transport policies to be modelled at the
# individual level [@Lovelace2014-jtg].
# Even when travel surveys contains geographical information,
# sample sizes are generally comparatively small, less than 1% of the population,
# making them inappropriate as the sole source of input data for
# geographical modelling at the local level. 
# Flows inferred from mobile phones are a promising new dataset for inferring
# travel behaviour. Recent
# work has been able to accurately reconstruct travel flow patterns from millions
# of anonymous users, including inference of purpose of travel [@Alexander2015].
# If origin-destination flow estimates resulting from such datasets
# become more widely available to researchers, this could constitute one of the
# most single most valuable data sources for transport planners worldwide.
```

# Data manipulation and modelling

## Loading data geographic data

To ensure reproducibility and enable deployment of the model outside the
original case study cities, a systematic data loading method was
developed. The computational work to load the various datasets
was developed in a series of modular scripts that were subsequently
integrated into a single script: `load.Rmd`. This approach ensures that
each component of the data (e.g. OD data, administrative zones,
topography data) can be loaded separately with a single 'master'
script to bring together the diverse data
sources.^[See
[github.com/npct/pct/tree/master/loading-data](https://github.com/npct/pct/tree/master/loading-data) for a full list of the loading scripts used for the PCT.]

Instead of running the model for the entirety of England, the loading
script, OD model and output visualisations were run on a region-by-region basis.
This was to prevent overloading the computer with national data and to
focus attention on the level at which funding is allocated.
Using only one regional geographic level
could, however,
reduce emphasis on 'edge zones' that straddle two
or more regions. To overcome this issue it is worth considering
using more than one regional geographical system.
A modified version of the model could be run at the national level.
Another solution to the problem of 'edge zones'
is to create buffers around the regions (as discussed below).
We plan to test each of these options in future work, and ask
practitioners for feedback on the advantages and disadvantages of each.

```{r, echo=FALSE}
# The wider national policy context should be considered when selecting
# the regional geographies that are appropriate for the model.
# In Phase I of the work to implement the PCT for the UK we used LADs, then switched to CUAs after user testing.  TTWs also possible, and in the long term perhaps LEPS.  Our recommendation is to build it at the CUA level
```

Many transport decisions (such as where to build new cycle routes)
are made at the local level [@Gaffron2003]. In England however, there is
sometimes a difference between the areas covered by Highway Authorities and
the more commonly used Local Authority District (LAD) divisions
(Fig. 2).^[Highway
Authorities and LADs will coincide in places where there are ‘unitary authorities’ (e.g. in England’s large conurbations, and the whole of Scotland and Wales). However in many parts of rural England, the Highway Authority will cover several District Authority areas. in any event though, the regions used as the building blocks of the PCT can adapt to reflect either, or alternative, funding structures (e.g. England’s Combined Authorities or Local Enterprise Partnerships
(LEPs)).
]

```{r, echo=FALSE}
# As well as CUA level an increasing proportion of transport funding in
# England is also being allocated to Local Enterprise Partnerships (LEPs)
# and Combined Authorities (CAs) which are larger than, and often overlapping with, CUAs.
# Based on these insights, and feedback from practitioners, our
# recommendation for Phase II is to build the PCT for every CUA in
# the nation and for selected LEPs and CAs where strategic
# cycling plans are being planned. These suggestions may change based on
# feedback from the Department for Transport.
# 
# We will also explore the possibility of
# running the model at the national level. This would involve setting
# appropriate selection criteria to filter-out the majority of
# origin-destination pairs to avoid exceeding computational resources.
# The demarcation of regional boundaries is deemed useful for focusing
# on one region at a time.
# 
# Phase I of the PCT project focused instead on smaller administrative units:
# Local Authority Districts (LADs). There are 324 LADs across England.
# For the case study towns of Manchester and Coventry, the choice between
# CUA and LAD levels
# made no difference as LADs and CUAs have the same boundaries for these areas.
# For Norwich, however, the LAD is much smaller than the CUA and is less
# practical for strategic transport planning at the MSOA level (Fig. 2).
# For this reason
# we implemented a buffer selection methodology to expand the scope of the
# selection, as described in the next section. Before describing the
# buffer selection method, it is worth briefly considering some
# of the other regional geographies that could be used: Travel to Work Areas (TTWAs),
# which could be applicable in many contexts and Local Enterprise Partnerships
# (LEPs) which are specific to the UK context.
# 
# TTWAs are 'commuting watersheds' that correspond to
# cohesive regions, the centres of which are known employment centres [@Coombes2008].
# Versions of the PCT model developed for more scientific purposes would benefit
# from using TTWAs as the regional geography for local scenario development and
# visualisation.
```

```{r cuas-lads, echo=FALSE, fig.cap="Local Authority District (LAD, above) and County and Unitary Authority (CUA, below) levels of transport planning. These are potential regional units for the Propensity to Cycle Tool"}
grid.raster(readPNG("../figures/cuas-las.png"))
```

## Variable zone and OD pair selection criteria

Flows assigned to the transport network were generated when OD pairs were
mapped onto the current
travel network.
This network-level data generation 
was undertaken by CycleStreets.net (a routing service for
planning cycle trips), constituting the most computationally intensive part of the model.

To reduce data processing and visualisation times
a sub-sample of OD pairs was used.
The aim was to reduce the number of OD pairs whilst retaining the overall
travel pattern. To do this a minimum number (labelled `mflow`)
of trips between OD pairs was specified. OD pairs with less than
`mflow` trips were removed from the analysis. This followed the insight that the
distribution of number of commuters per OD pair is
skewed: a relatively small number of OD pairs along major travel corridors
account for a disproportionately high proportion of travel.
In the City of Manchester, for example,
setting `mflow` to 30 reduced the number of OD pairs by 85%, yet
still accounted for almost 70% of commuters.
Different values for `mflow` were tested to reach a reasonable
balance between comprehensive coverage and speed of saving and loading data.
Another way to subset OD pairs is to set the maximum Euclidean
(or "crow-flies") distance between OD pairs (labelled `mdist`).
We tested various values for `mdist` and settled on
15 km. This translates to around 20 km
on the route network (assuming a circuity value of 1.3).
From the Great Britain National Travel Survey, only 1.1% of cycle commutes
in Britain exceed this distance.

## The regression model

Once the input data (discussed in the previous section)
has been processed and sub-setted to the area of interest,
it is passed to a regression model. 

For all scenarios except *gender equality*, a regression model was used
to estimate the potential rate of cycling at the OD level.
It does so using Ordinary Least Squares (OLS) to
optimize a number of model parameters
linking distance ($d$) and hilliness ($H$) to the *dependent variable*:
the proportion of trips made per OD pair ($pcycle$).
The concept of 'distance decay' [@Martinez2013]
was used in the model to describe the (non-linear) relationship
between the route distance of OD pairs and the proportion of trips made by cycling.
Euclidean distance could be used in contexts where route distance is not known.

It is well-known that
$pcycle$ tends to decrease with increasing distance [@Iacono2010].
Based on this work and exploratory analysis of the data we estimated
the $log$ of $pcycle$ rather than $pcycle$ directly.
Hilliness was included a continuous variable in our model
and was expected to have a linear impact on $pcycle$.
The formula chosen was:

(@) $$ log(pcycle) = \alpha + \beta_1 d + \beta_2 d^{0.5} + \gamma H $$

```{r, echo=FALSE}
# {#eq:description}
```

where $d$ is distance (km, route distance between population weighted centroids) and
$H$ is the hilliness (average angular degrees of origin and destination zones)
per OD pair. The remaining values are scalar
coefficients to be estimated.
$\alpha$ represents the intercept (the rate of cycling very short
trips). $\beta_1$ (which must be negative for $pcycle$ to tend to zero as
distance tends to infinity) and $\beta_2$ represent the rate of distance decay.
$\gamma$ represents the impact of hilliness on cycling.
A 'quasipoisson' general linear model was used to implement this formula
using the base R function `glm`, which predicts $log(pcycle)$
to account for the aforementioned exponential decay.

## Zone Buffer

Running the PCT region-by-region means
ignoring all the MSOA zones outside the region. If the region is a
self-contained transport system this will not create problems.
If the region is part
of a larger conurbation, however, the clipping could be problematic.
To solve this problem we created buffers around each region,
from which additional zones were sampled in regions in which
the number of MSOA zones fell below some threshold.
We set this threshold to 60.
This meant that additional zones were
selected outside the City of Manchester, which has 57 MSOAs
(see Fig. 7 below).
This protocol increased the sample size by including all
zones whose population-weighted centroid lies inside the
buffer, the width of which can also be pre-specified.

## The Model Output tab

Users can view a summary of the model via the 'Model Output' tab (Fig. 3).
This serves three purposes: to show the underlying model;
to ensure transparency; and to provide further information.
The tab was added in response to feedback during the user testing sessions.
The output tab communicates the results of the model,
including key statistics, diagnostic plots and model-results on a per-region
basis. This means that a different summary document is provided depending on
which local authority the user is currently exploring.

```{r, echo=FALSE, fig.cap="The Output Tab of the Propensity to Cycle Tool"}
grid.raster(readPNG("../figures/model-outpute.png"))
```

```{r, echo=FALSE}
# Some of the outputs of
# the Model Output tab are illustrated in Fig. xx to Fig. xx below.
# ```{r, echo=FALSE, fig.cap="The distance decay curve resulting from the log-square-root function. The green lines represent increases of 0.25 times original parameter values (obtained by running the model on data from the 2011 Census for Manchester) and the red lines represent -0.1 times the original value."}
# grid.raster(readPNG("../figures/log-sqrt-params.png"))
# ```
```

# Model scenarios

Scenarios were developed to indicate how local cycle use
could increase following the removal of various constraints that
currently inhibit cycling in England below its long-term potential.
These constraints include a mix of infrastructural and cultural factors.
Note that the impact of poor cycling conditions and the
cultural resistance of certain groups to cycle may well be
inter-related. More fundamental constraints to cycling include the
aforementioned factors of distance and hilliness, which can to some degree
be overcome by new technology (see the *ebike* scenario below).

The four scenarios developed for the case study cities were developed to
explore different cycling futures in England.
Because timescales are not specified, they are not
necesarily mutually exclusive. 

- Government target (*govtarget*). This scenario represents a doubling of
the number of cycling trips in England. 
Although this is a substantial increase in relative terms, cycle use still
remains low in this scenario compared with countries such as the Netherlands,
rising from 3% to 6% of commutes.
*govtarget* allows for different rates of growth in different places.
Above-average percentage increases (i.e. more than a doubling) are projected in areas
with many short (i.e. potentially cyclable)
trips and a low current rate of cycling.
Conversely, areas with higher cycle use and a low proportion
of short commutes will have below-average growth.
*govtarget* represents a slight reduction
(but not elimination) of the localised infrastructural or cultural
constraints which deter cycle use more in some places than in others.
It therefore indicates where investment in increased cycle use might achieve the greatest impact in the short term.

- Gender Equality (*gendereq*). This scenario illustrates the increase in cycling
that would result if women cycled as much as men, all other variables being equal.
Specifically, the scenario sets the proportion of female cycle commuters
to the current proportion of males in each OD pair.
The scenario is based on the observation that in places where cycling is the norm,
women cycle at least as much as men (Pucher et al 2010).
*gendereq* thus represents
the elimination of one specific cultural constraint.
This scenario has greatest relative impact in areas where
the rate of cycling is highly gender-unequal (Fig. 4).
In absolute terms, cycling increases most in this scenario where cycling
is already a common mode of transport.

- Go Dutch (*dutch*).
While *govtarget* and *gendereq* build on current cycling behaviour,
the *dutch* scenario focuses on long-term potential.
If English people were as likely to cycle for a given trip (i.e. of the same
distance and hilliness) as Dutch people, then how would the rate and spatial
distribution of cycling change?
The Go Dutch scenario answers this question by applying Dutch
distance decay curves to English travel patterns.
'Go Dutch' therefore represents the elimination of the
infrastructural and cultural constraints which currently hold back cycle
use in England, including all localised differences.
So, unlike the *govtarget* and *gendereq* scenarios,
the predicted levels of cycle use in *dutch*
are unrelated to current levels, and are constrained
only by local trip distance distributions and hilliness.

- E-bikes (*ebikes*). This scenario models the additional increase
in cycle use that would be achieved through the widespread uptake of electric
cycles ('E-bikes').
E-bikes enable longer journeys and make cycling a more viable option for
a number of people, including those with low fitness and people
with impaired mobility. This scenario is based on the Go Dutch scenario.

These scenarios are described more fully below.
They are not intended to be definitive scenarios of cycling futures
in England or anywhere else; we encourage users of the PCT to
develop new scenarios relevant to new contexts.

```{r, echo=FALSE}
# We have data on the following variables and the impact of each on model
# fit will be explored (we will also explore additional variables for which we do
# not yet have data in a suitable form for the model such as weather):

# - Gender balance. The remit for including this variable is that the male:female
# ratio of cycle commuters is around 3:1 in the
# UK;^[The mean proportion of male cycle commuters from the 2011 census
# across Local Authorities
# in England is 0.77. This corresponds to a ratio of 3.3:1.]
# thus including the
# proportion of short (5km and less) trips made by females can
# greatly improve model fit. Note that this variable was used at the areal
# unit level (per zone, as opposed to per origin-destination pair) due to
# data limitations. Critically, this variable can be used as the basis of
# scenarios estimating the impact of a 'gender equality' scenario for cycling
# increase at the local level.

# - Age.
```

```{r, echo=FALSE}
# - Gender. There is evidence that women are more put-off cycling
# by poor transport infrastructure and heavy traffic than men, so this could be
# linked to a measure of transport infrastructure quality.
# - Weather. It rains in some places more than others and there is evidence
# to suggest that this is a deterrent to cycling. This could be included with
# reference to interpolated rasters of estimated rainfall.
# 
# - Age/occupational status. There is evidence that much of the uptake
# in cycling in some
# areas has been due to students and other mobile groups taking up cycling
# when they move away from home. This could be represented in the model as
# % of students or % of people between 16 and 30 in each area.
# 
# - Infrastructure quality. Preliminary tests with the commuting data suggest that
# having a direct off-road path along the flow-line is a strong predictor of the
# rate of cycling. This can be quantified in various ways, for example
# via the 'quietness diversion factor' ($qdf$), the ratio
# between the 'quietest' and the 'fastest' route calculated by CycleStreets.net ($qdf = d_{fast} / d_{quiet}$).
# The inclusion of this variable per OD pair creates an opportunity
# to estimate the short-term impacts of new or improved cycle provision,
# up to the standard of a current average quieter route but along
# a more direct route.
# By setting $qdf$ to 1 (i.e. setting $d_{quiet} = d_{fast}$), the
# increase in the number of cyclists using upgraded routes can be estimated.
# An example in which the length of a quiet route is much further than
# the fastest route (i.e. $qdf > 1.2$) is provided at the end of this
# paper, in Fig. 9. Note that $qdf$ is different than
# circuity ($q$), the diversion
# from straight-line (Euclidean) distance as it approximates
# represents *how much further* one must travel to use a quiet path.
# Where $qdf$ is low, this means that the quiet routes are also the
# most direct, which will likely encourage new cyclists.
```

```{r, echo=FALSE}
# ## Baseline
#
# The baseline scenario (*baseline*)
```

## Government Target

```{r, echo=FALSE}
# Taking population increases and trip rate decreases into account,
# the target implies a doubling in the proportion of trips made by cycling nationwide [@Crawford2014].
```

The Government Target scenario (*govtarget*)
is based on the UK government's proposed target
(as set out in its draft Cycling Delivery Plan [@DepartmentforTransport2014])
to double cycling in England, from 0.8 billion stages currently to 1.6 billion stages by 2025.
However @DepartmentforTransport2014 says nothing about where these additional
trips would come from. The *govtarget* scenario is therefore based on our own
assumptions about this --- see the next paragraph. It aims to assist transport
planners in identifying where new demand for cycling is likely to be greatest in
the near term.

The key point about this scenario is that cycling does not simply double in all
areas. Instead, the increase depends on the proportion of
commuter trips in each area that are cyclable (i.e. typically less
than around 5 miles).

```{r, echo=FALSE}
# The *govtarget* scenario therefore projects above
# average growth (i.e. more than a doubling)
# in areas with many cyclable length but a
# low current rate of cycling. Lower relative increases in cycling
# are projected in areas where a relatively low proportion of trips are
# cyclable and high current cycling rates.
# Old description of govtarget
# The *govtarget* scenario also relates to the *distribution* of trips
# in the study area compared with the data used for the model.
# If the distribution of
# all trips in the regression model
# is flatter than the distribution of cycling trips in the study area,
# a doubling in
# propensity will not lead to a doubling in cycling. If, on the other hand,
# the distribution of cycling trips in the study area mirrors high
# volume OD pairs for which cycling is currently rare,  a doubling in propensity
# will more-than-double the rate of cycling. If the study OD pairs are the same
# as the data used to train the model, *govtarget* always results in a doubling in
# cycling. These concepts are illustrated in
# Fig. x below.


# ```{r, echo=FALSE, warning=FALSE, fig.cap="The rate of cycling under the govtarget scenario for a case study Local Authority (Coventry). OLC is represented in blue, SLC(govtarget) is represented by the white lines."}
# l <- readRDS("../pct-data/coventry/l.Rds")
# flow <- l@data
# mod_logsqr <- glm(clc ~ dist + I(dist^0.5), data = flow, weights = All, family = "quasipoisson")
# flow$fitted <- mod_logsqr$fitted.values * flow$All
# coefs <- coef(mod_logsqr)
# ff <- stplanr::dd_logsqrt(x = flow$dist, a = exp(coefs[1]), b1 = coefs[2], b2 = coefs[3])
# # plot(ff, mod_logsqr$fitted.values) # perfect fit - function works
# flow$govtarget <- ff * 2 * flow$All
#
# l2 <- rep(l$dist, l$All)
# l3 <- rep(l$dist, l$Bicycle)
# l4 <- rep(flow$dist, flow$govtarget)
# # hist(l2)
# p2 <- ggplot() + geom_histogram(aes(l2), binwidth = 0.5) +
#   geom_histogram(aes(l3), binwidth = 0.5, fill = "blue") +
#   geom_histogram(aes(l4), binwidth = 0.5, col = "white", fill = NA, linewidth = 5) +
#   scale_y_log10() + xlab("Distance (km)")
#
# p1 <- ggplot() + geom_histogram(aes(l2), binwidth = 0.5) +
#   geom_histogram(aes(l3), binwidth = 0.5, fill = "blue") +
#   geom_histogram(aes(l4), binwidth = 0.5, col = "white", fill = NA, linewidth = 5) + coord_cartesian(ylim = c(0, 2000)) + xlab("Distance (km)")
#
# library(gridExtra)
# grid.arrange(p1, p2)
# ```
```

At the heart of the *govtarget* scenario is the previously discussed
regression model (labelled $natmod$) estimating
the dependent variable (*pcycle*).
The new rate of cycling ($pcycle(govtarget)$) is the current rate of
cycling plus this model-based estimate:

(@) $$ pcycle(govtarget) = (pcycle + pcycle(natmod)) $$

where $pcycle$ is the proportion of commuters who cycle per OD pair
in the 2011 Census and $pcycle(natmod)$ is the proportion of commuters expected to
cycle based on the national-level regression model.
The sum of these values
is multiplied by $tflow$, the total number of commuters for all modes,
to convert the proportion into
a number of cyclists, i.e.:

(@) $$ SLC(govtarget) = (pcycle + pcycle(natmod)) * tflow $$

An example of this scenario for illustrative purposes is as follows.
Based on a representative sample of OD pairs in the UK,
among those making trips with a 'fastest route' distance of between 4 and 5 km,
the proportion who used a cycle as their main mode is 5.0%.
Under the 'national doubling' assumption of the *govtarget* scenario,
assume the total increase in the proportion of cyclists in this distance band is
around 5.0% --- i.e. $pcycle(natmod) = 0.05$ for trips of 4 to 5 km.
In the City of Manchester the proportion of commuters
travelling 4 to 5 km to work,
who used a cycle as their main mode, was 4.6% ($pcycle = 4.6$).

All else being equal (specifically, assuming average hilliness in
Manchester is equal to the national average), the percent of
commuters cycling to work in this case under the Government Target
scenario ($SLC(govtarget)$) would be 4.6% + 5.0% = 9.6%.
The number of commuters cycling to work along this OD pair
($SLC(govtarget)$) would thus be 9.6% multiplied by $tflow$,
i.e. the proportion cycling multiplied by the total number of commuters.

Note that this does not mean
that $SLC(govtarget) = 9.6% $ in *all* OD pairs in Manchester between 4 and 5 km
because initial levels of cycling
vary widely. An OD pair with an exceptionally high initial rate
of cycling, for example (e.g. *pcycle* = 30%), would end up with a projected
rate of cycling of 35% (*pcycle(govtarget)* = 35%). Likewise, an OD pair
with a Euclidean distance of 4.5 km and average hilliness,
that has no cycling currently, would be projected to reach 5%. The same methodology
is applied to all distances represented in the OD matrix, allowing the total
rate of cycling in the city to be estimated.

The approach assumes that cycling potential against a given national
increase is always a positive number.
The larger the increase in cycling for the scenario, the less the baseline matters
influences the projected rate.
By contrast, the larger the current rate of cycling, the lower the
impact of the scenario on the future rate of cycling.

Our implementation of the *govtarget* scenario is thus in line with findings from
@Sloman2014 and @Heinen2015, who found that it is initially
easier to achieve growth in cycle use in places where it cycling is
already common.
However, with sustained investment in overcoming the infrastructural and
cultural constraints which limit cycle use,
there is great long-term potential for
increased cycling in many areas that currently have a low rate of cycling.
This is modelled in the Go Dutch scenario (described after the *gendereq* scenario).  

```{r, echo=FALSE}
# Although the *govtarget* and gender equality (described below)
# scenarios take the current rate of cycling
# into account, the method currently does not accoun
```


## Gender equality

The next scenario to be discussed is Gender Equality (*gendereq*). In this
scenario cycling tends to grow more in areas that already have a high
rate of cycling. *gendereq* is more about immediate propensity than longer-term
potential levels of cycling. The scenario
recognizes that this disparity is reduced or absent in
countries with a high rate of cycling [@Fishman2015].
The Gender Equality scenario (*gendereq*) builds on such insights
and is based *observed level of cycling* (*OLC*) from the 2011 Census.

On average in England around  3/4 of cycle commuters
are male, although this varies geographically [@Aldred2015].
*gendereq* assumes that gender equality is reached in cycling.
Specifically, the scenario assumes that in each OD pair the proportion
of female cycle commuters is the same as the proportion of males.
A prerequisite is a model-based estimate of the number of male
and female cyclists between origin and destinations for
the observed data.
This involves splitting the number of cyclists project by the model,
the *Scenario-based Level of Cycling*, into
male ($SLC_m$) and female ($SLC_f$) components:

(@) $$ SLC = SLC_m + SLC_f $$

More males cycle to work than females in every Local Authority in England
(Fig. 4). For this reason, the *gendereq* scenario
is based on the assumption that the rate of cycling amongst
females increases to match the rate of cycling amongst males.
Under *gendereq* $SLC_m$ remains constant. The challenge is to
find the value of $SLC_f$ such that the proportion of
female cycle commuters under the gender equity scenario ('$pcycle(gendereq)_f$')
becomes equal to the observed proportion of male cycle commuters ($pmale_{cyclist}$).
Note that this is not as simple as $SLC_f = SLC_m$,
as the absolute number of female and male cyclists will also depend on the gender split of the total commuting population within each OD pair.^[To
illustrate this point, consider an OD pair in which the total number of female
commuters is larger than the total number of male commuters.
In this case, the number of female cyclists would exceed the
number of male cyclists in the *gendereq* scenario.
]
It is the *proportion* of males and females
per OD pair who cycle that becomes equal, as follows.

(@) $$ pcycle(gendereq)_f = pcycle_{m}$$

(@) $$ \frac{SLC(gendereq)_f}{tflow_f} = \frac{OLC_m}{tflow_m} $$

(@) $$ SLC(gendereq)_f = tflow_f * \frac{OLC_m}{tflow_m}$$

$OLC_m$ is the observed number of male cycle commuters
(in the 2011 Census in this case),
$SLC(gendereq)_f$ is number of female cycle commuters in the gender equality scenario, and
$tflow_m$ and $tflow_f$ are the total numbers of males
and females in the OD pair respectively.

$tflow_m$ and $tflow_f$  are both available at the OD level in the 2011 Census,
as is the total number of cyclists ($OLC$).  The proportion of cyclists who are male
in each OD pair ($pmale_(cyclist)$) is not, however, available in the published 2011 datasets
(although we intend to commission such tables for future work).
The smallest level at which the gender breakdown of cyclists is currently available
is the zone level ('$pmale_{cyclist}(zone)$'), and we assume that all OD pairs have
this same proportion of male cyclists. This allows the estimation
the number of male cycle commuters as $OLC_m = OLC * pmale_{cyclist}(zone)$, so that

(@) $$ SLC(gendereq)_f = OLC * pmale_{cyclist}(zone) *  \frac{tflow_f}{tflow_m} $$

and therefore the total number of trips for gender equality $SLC(gendereq)$ would be

(@) $$ SLC(gendereq) = OLC_m + SLC(gendereq)_f $$

(@) $$ SLC(gendereq) = OLC * pmale_{cyclist}(zone) * (1 + \frac{tflow_f}{tflow_m}) $$

```{r, echo=FALSE, fig.cap="Cycling and the gender balance of cycling in England. The choropleth maps illustrate the spatial distribution of the two variables. The scatter plot illustrates the relationship between the two variables cycle commuting (x axis) against the proportion of commuter cyclists who are male (y axis) for all 326 Local Authorities (including Districts) in the UK."}
grid.raster(readPNG("../figures/las-gender-pcycle.png"))
```

To illustrate how this method works in practice, imagine an OD pair in which
5 from a total of 50 people commute by cycle ($tflow = 50; OLC = 5$).
30 of the total trips in the OD pair are made by males
($tflow_m = 30$) and 20 by females ($tflow_f = 20$).
In addition, 70% of commuter cycling in the wider zone is by
males ($pmale_{cyclist}(zone) = 0.70$). This means that
an estimated $5 * 0.70 = 3.5$ cycle commuters are male ($OLC_m = 3.5$) and
1.5 are female ($OLC_f = 1.5$).
These are not whole numbers but represent the average
number expected in many OD pairs with the same characteristics.

Applying the formulae presented on the previous page:

(@) $$ SLC(gendereq)_f = OLC * pmale_{cyclists}zone * (1 + \frac{tflow_f}{tflow_m}) $$

(@) $$ SLC(gendereq) = 5 * 0.70 * (1 + \frac{20}{30} ) = 5.83 $$

```{r, echo=FALSE}
tflow <- 50
olc <- 5 #  the currect rate of cycling between origin (o) and destination (d)
tflow_m <- 0.6 # the proportion of all trips o and d by males
pcyclez_m <- 0.75 # the proportion of cycle trips in the zone/region made by males
tflow_m <- tflow * tflow_m
tflow_f <- tflow * (1 - tflow_m)
olc_m <- olc * pcyclez_m
olc_f <- olc - olc_m
pmale_c <- olc_m / tflow_m
slc_gendereq_f <- tflow_f * pmale_c
# print(olc_f)
# print(slc_gendereq_f)
```

The increase from 5 cyclists to 5.83 represents an increase
of 17% from the observed rate of cycling
in total numbers of cyclists.  All of these extra 0.83
cyclists are female, giving a new total of 1.5 + 0.83 = 2.33 female cyclists
(and still 3.5 male cyclists).
Gender equality in cycling has been reached, such that an estimated 11.7
% of commute trips are made by cycling among both men (3.5/30)
and women (2.33 / 20).

## Go Dutch

The 'Go Dutch' scenario represents the rate of cycling that would occur
if people had the same propensity to cycle as the Dutch do, for trips of
the same length and hilliness. It is
important to note that this is not a 'top down' scenario in which the national
level of cycling is set to levels found in The Netherlands. The scenario is
'bottom up' because the proportion of trips being cycled is set per OD pair
and the end result for any particular region depends on the local distribution
of trip distances.
Although the Dutch currently cycle far more frequently than the
English for short trips, their propensity to cycle still drops rapidly with
distance, with relatively few utility trips being made beyond around 15 km.

Based on these insights, the essence of the 'Go Dutch' scenario
(henceforth simply *dutch*) is the application of distance decay parameters
found in the Netherlands to each OD pair in the study area.

In contrast to *govtarget* and *gendereq* scenarios,
Go Dutch is unrelated to the current rate of cycling. The scenario
thus represents the elimination of localised
constraints which inhibit cycle use more in some area than others.
Local cycle use in Go Dutch is therefore constrained
only by trip distances and hilliness.

## E-bikes

The aim of this scenario was to provide an indication of the increased rate of cycling
be possible due the uptake new technology, specifically electric cycles ('E-bikes').
The scenario represents a reduction in the degree to which cycle use is 
constrained by trip distances.
This is the most ambitious and speculative
scenario presented in this paper; it
builds on 'Go Dutch'.

The results are
based on the decision to increase by a small amount the $\beta_1$ distance decay parameter,
that corresponds to distance as a linear term.
Specifically, we increased this value by 0.025, as we found
this to be sufficiently small to avoid generating an
implausibly high rate of cycling but sufficiently large to create a noticeable effect.
This allows us to illustrate the type of output that will
be possible in this model. In future work we plan to
update this scenario, basing the changes to the distance decay
parameters on real data from the Dutch National Travel Survey.
This will build on analysis of the influence of E-bikes on propensity to cycle
in the Netherlands that is being undertaken in parallel to the work
presented in this paper. 

# Results

To demonstrate
how the scenarios work in practice and to provide an overview of the results,
Fig. 5 illustrates the observed level of cycling
($OLC$, from the
2011 Census) and the scenario-based level of cycling
in two Local Authorities (Manchester and Norwich). Note that while Manchester
has a much higher total number of trips than Norwich, the proportion of those
trips that are made by cycling is lower. There is noticeable distance decay
for all modes of transport, especially for cycle trips in Norwich,
where cycle trips above 7.5 km observed from 2011 census data are
comparatively rare.

Note that although Manchester and Norwich have very
different initial levels of cycling, the final level estimated from the
*dutch* and *ebike* scenarios there are similar. This because
trip distance distributions in the two cities are comparable --- these long-term
scenarios are not influenced by the current rate of cycling.
Note also that the *govtarget* scenario
in Manchester has a considerably higher rate of cycling than the *gendereq*
scenario, whereas in Norwich these scenarios are very similar. This is because
Manchester is starting from a lower baseline, so a doubling nationwide
results in a relatively high absolute increase in cycling locally. In Norwich,
by contrast, the current rate of cycling is considerably greater than the
national average, so the *govtarget* scenario represents less than a doubling in
cycling.

```{r, echo=FALSE, fig.cap="Results of observed and scenario-based levels of cycling from PCT model runs for the city of Manchester (left) and Norwich (right)."}
grid.raster(readPNG("../figures/man-nor-output.png"))
```

The difference between the spatial distribution in cycling potential between
the Government Target (*govtarget*) and Go Dutch
(*dutch*) scenarios is illustrated in Fig. 6 for Norwich.
Note that the top 20 OD pairs
in Norwich under *govtarget* assumptions are dominated by the current rate of cycling,
with the most travelled desire lines projected to continue to be found towards the east of
the city (this can be explained by the location of the University of
East Anglia to the east of the city).
Under *dutch* assumptions, by contrast,
the pattern of cycling shifts substantially to the west.
The cycling pattern under the *dutch* scenario
are more representative of short-distance trips across the city overall.
In both cases the desire lines are focused around Norwich city centre: the region
has a mono-centric regional economy, making trips beyond around 5 km from the
centre much less likely to be made by cycling.

```{r, echo=FALSE, fig.cap="Model output illustrating the top 20 most cycled OD pairs in Norwich under Government Target and Go Dutch scenarios."}
grid.raster(readPNG("../figures/nor-cdp-dutch.png"))
```

The equivalent results are shown for the city of Manchester in Fig. 7. This shows that
Manchester has a poly-centric structure, favouring the construction of cycle
routes between the various sub-centres, not just in radial routes to a single
centre. Note in both scenarios the large increase in the level of cycling in
between *govtarget* (which represents only a doubling nationwide) and *dutch*
scenarios (which represents a more ambitious plan for cycling uptake).

```{r, echo=FALSE, fig.cap="Model output illustrating the top 20 most cycled OD pairs in Manchester under Government Target and Go Dutch scenarios."}
grid.raster(readPNG("../figures/man-cdp-dutch.png"))
```

As described earlier, Cyclestreets.net was used to allocate OD pairs to
the travel network. 'Fastest' and
'quietest' routes were estimated by the service and the difference between
these routes can be important from a transport planning perspective.
Fig. 8 illustrates this by showing route in Manchester with the highest cycling
potential under the *govtarget* scenario.
The 'quietest' route is substantially further, with a
distance of 2.8 km (as shown by clicking on the line). The 'fastest'
route is more direct (with a route distance of 2.3 km) but passes
along Trinity Way (the A6042), a busy dual carriage way.
The PCT (with the 'Straight Lines' option) tells us that Euclidean distance
associated with this OD pair is 1.6 km, resulting in circuity values of
1.44 and 1.75 respectively.

Dutch evidence suggests that cyclists are generally unwilling to
take a path that is more than around 1.3 to 1.5 times the length of the
'crow-flies' Euclidean distance (defined as $q$ above).
The same research suggests target "for cycle provision should be 1.2" [@crow2007].
This suggests that high quality cycle infrastructure along the Trinity Way route
would be much better used by commuters than an
alternative quiet route that diverges greatly from the shortest path.
The decline in cycling propensity with distance supports this approach.
The faster decline for women and older people, combined with their greater
preference for protected infrastructure, highlights the importance of
providing direct and safe routes to encourage cycling amongst
groups who currently cycle the least.

```{r, echo=FALSE, fig.cap="Close-up of the 'fastest' and 'quietest' routes from CycleStreets.net of the OD pair with highest cycling potential under the *govtarget* scenario in Manchester."}
grid.raster(readPNG("../figures/fast-quiet-man.png"))
```

# Discussion

The flexibility of the PCT methodology
enables it to be used for applications that go far beyond those described
in this paper. Because the underlying
methods and computer code are transparent and open source, it is
possible to use the PCT as a platform for further research and planning
applications. This flexibility
has so far been demonstrated by the tool's ability to be deployed in any
Local Authority (or other administrative area)
in England. Extensibility has been demonstrated by the addition of
new scenarios. Three user testing sessions have helped identify shorter-term
changes to the interface (such as 'freeze scope') and longer-term needs
(such as the use of additional data sources).

Planners can use the different scenarios to consider short, medium, and
long-term potential for cycling locally and along specific routes,
in combination with local knowledge.
In the PCT can therefore shed light on the following question,
previously raised by  @Sloman2014 and @Aldred2014:
Should cycling investment prioritise
areas of relatively low current propensity but high potential, or those of relatively
high current propensity but lower potential?

In the Netherlands (representing long-term ambition for cycling),
cycling is equally common
among males and females. Cycling levels are also even
between different socio-economic groups,
although ethnic and religious differences exist [@Fishman2015].
Demographics should therefore play less of a
role in estimating cycling potential for strategic purposes
than for identifying 'quick-win' policies based on current propensities.
Based on this understanding, the PCT has the ability to represent different
scenarios of change. Illustrations of how the 
pattern of cycling could shift to new transport corridors in the
hypothetical future represented by 'Go Dutch' were
described as 'very useful' by transport planners during user testing.
This finding coincides with 'visioning' work, which has great potential
to improve transport planning for the long-term [@Tight2011].

The results of user testing indicated the utility of online, interactive and open source
web applications for cost-effective
allocation of investment. Local Authority transport planners working in active
travel said that the tool
could be useful for setting local targets or implementing
locally-specific policies. To follow-up on such feedback, modifications of the methods
described in this paper are planned, to help determine the suitability of localised
cycling targets in relation to investment 
options.^[Targets have proliferated in recent years. For instance, an official
target to reach 10% of trips made by bicycle has been
made by authorities in Dublin, Leicester and across
all of Scotland over various time-scales [@Beatley2012]. A mode share of
"20% by 2020" has been set for several cities including San Francisco and
Orlando.]
Moreover, as illustrated by the *govtarget* scenario, the method can be used to
translate national targets into local aspirations.

Potential applications go far beyond these policy relevant near-term
applications. Wider extensions of the model that could build on the framework
presented here include:

- Additional 'output tabs' in the PCT's user interface, to estimate the
quantitative benefits of cycling uptake at the local (and potentially
route-allocated) level. Benefits estimated could include health savings
through increased physical activity to feed into models such as HEAT
[@Fraser2011]. Geographically specific energy and
carbon savings of cycling uptake could also be estimated [@Lovelace2011c].

- Deployment of the PCT for entire countries.
This would depend on having appropriate OD data and could
could build on emerging 'Big Data' sources for origin-destination
flows [@Alexander2015].

- International comparisons of cycling potential.
This could include include an exploration of
the relationship between places of high potential and investment.
We have already begun this by using Dutch distance decay functions in an English
context, but more could be done by fully implementing the model in different
country contexts.

- The extension of the model to cover variation between different demographic
groups. This could be done using the method of spatial microsimulation, which
enables the use of additional individual-level variables,
such as access to a cycle,
to inform more targeted interventions [@Lovelace2014-jtg].

- Additional purposes of trips in the model.
An 'education layer' would enable prioritisation of 'safe routes to school',
building on methods analysing 'school commute' data [@Singleton2014a].

- The extension of the tool to enable the estimation of cycling demand
following new developments, such as high-density housing, a new
school or local job creation.

The PCT's open source licence allows others to
modify it for their own needs. We actively encourage practitioners
to 'fork' the project [@lima2014coding],
to modify the scenarios, input data and display of the results to suit
local contexts. This could, for example, help to visualise city-level targets for
the proportion cycling by a certain year and
which will vary considerably from place to place in ways not yet well understood.
Modifying the code base would also allow transport planners
to decide on and create the precise set of online tools that are
that are most useful for their work.
Building on participatory models at the macro-level [@Macmillan2014], extensions
to the model could include using the PCT methodology to
enable public engagement in the strategic planning process around
sustainable transport.

Transport policy is a
complex and contested field [@Banister2008].
Therefore policy, politics, leadership and vision are key ingredients for sustainable
urban mobility that computer models alone cannot provide [@Melia2015a].
The approach described here can assist in this wider context by providing
new tools for assessing the best available evidence.
The PCT thus supports informed and open decision making.
A more specific limitation of the PCT is its current lack of inclusion
of detailed cycle route quality data (e.g. width and bumpiness of
path), which could help planners assess the scale of
changes needed to enable substantial uptake.  Future versions of the tool could
make use of
data derived from new network assessment technologies
[@Joo2013]. 

```{r, echo=FALSE}
# However, we would argue that cycle path quality is not something
# that needs to be modelled at the meso-level in a tool such as the PCT. The
# tool's niche is strategic planning for cycling uptake: once areas, travel
# corridors and road segments have been prioritised by the PCT, it is up to
# local transport engineers to ensure that the quality of the new paths is sufficient.
# Further work in this direction could explore the impact of high levels
# of 'telecommuting', for example, based on Finnish data [@Helminen2007].
```

The flexibility of the approach outlined in this paper means that
PCT can be seen not only as a tool but as a framework for strategic
transport planning.
Under this interpretation the case study of cycling in England is
just one of many potential applications.
Still, a number of the lessons learned throughout the
development and user testing of the tool are generalisable internationally.
Indeed, one of the major motivations for writing this paper is to showcase the method
for use by others to avoid 'reinventing the wheel' to solve such a ubiquitous
and embedded problem as the un-sustainability of current travel patterns.

Future work will focus on enabling practitioners to add
new features to the PCT. This is based on the understanding
that the people who best understand the
requirements of transport planners are the transport planners themselves.
By reducing barriers to entry in scenario-based transport modelling,
the PCT methodology can empower decision-makers, planners and citizens to
supplement their understanding of transport systems with evidence and plausible
visions of the future.

The PCT is highly policy relevant.
By identifying specific routes where intervention is expected to be most effective,
it can help to build business cases for further investment and policy change.
Moreover, by highlighting the importance of 'arterial' routes to key destinations,
the PCT can help rejuvenate longstanding debates
such as the re-allocation of road space away from
private cars [@Jones2014;@Sharples2009;@Black1992].
In conclusion, new tools such as the PCT can inform the decision of where to construct
new cycling infrastructure and, more widely,
strengthen the evidence-base needed for a transition
towards sustainable transport systems.

# Acknowledgements:

We would like to thank the following people for comments on earlier versions of the report and the development of the PCT:
Roger Geffen (CTC, the national cycling charity),
Helen Bowkett (Welsh Government)
and John Parkin (University of the West of England).
Thanks to Simon Nutall and Martin Lucas-Smith for access to and instructions
on the use of the CycleStreets.net API.
Thanks to developers of open source software we have been able to make
the PCT free and open to the world.
We would also like to thank Brook Lyndhurst for assistance with the user testing,
and all participants in the user testing sessions.
We thanks DfT staff for contributing to the design of the
PCT by offering feedback on early versions of the tool.

# Funding

The work presented was funded by the Department for
Transport (contract no. RM5019SO7766: "Provision of Research Programme into
Cycling: Propensity to Cycle"), with project management by Brook Lyndhurst. 
RL's contribution was supported by the Consumer Data Research Centre
(Economic and Social Research Council grant number ES/L011891/1).
JW’s contribution was supported by the Centre for Diet and
Activity Research (CEDAR), a UKCRC Public Health Research Centre of Excellence
funded by the British Heart Foundation, Cancer Research UK, Economic
and Social Research Council, Medical Research Council, the National Institute
for Health Research (NIHR), and the Wellcome Trust. AG’s contribution was
supported by an NIHR post-doctoral
fellowship. The views reported in this paper are those of the authors and do not
necessarily represent those of the DfT, Brook Lyndhurst, the NIHR, the NHS or
the Department for Health.

```{r, echo=FALSE}
# # Using the tool
#
# This Appendix summarises the work from the perspective of practitioners
# by describing how the PCT may be used to inform the decision-making process.

# My affiliation: UKCRC Centre for Diet and Activity Research (CEDAR), MRC Epidemiology Unit, University of Cambridge, School of Clinical Medicine, Institute of Metabolic Science, Cambridge Biomedical Campus, Box 285, Cambridge CB2 0QQ, UK
# 
# I also need institutional acknowledgement: Dr Woodcock’s contribution was undertaken under the auspices of the Centre for Diet and Activity Research (CEDAR), a UKCRC Public Health Research Centre of Excellence which is funded by the British Heart Foundation, Cancer Research UK, Economic and Social Research Council, Medical Research Council, the National Institute for Health Research, and the Wellcome Trust”
```

# References

```{r, echo=FALSE, eval=FALSE}
# file.copy("~/Documents/Transport.bib", "documents/Transport.bib", overwrite = T)
# this fails
# system("bibtool -x documents/flow-model.aux -o ~/Documents/Transport.bib")

# file.copy("documents/flow-model.docx", "~/Dropbox/DfT bid/Draft Writeups/Robin/flow-model.docx", overwrite = T)
file.copy("flow-model/flow-model.docx", "~/Dropbox/DfT bid/Draft Writeups/Robin/flow-model.docx", overwrite = T)
file.copy("documents/flow-model.pdf", "~/Dropbox/DfT bid/Draft Writeups/Robin/flow-model.pdf", overwrite = T)

```

